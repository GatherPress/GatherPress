(()=>{"use strict";var e={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},d:(t,s)=>{for(var n in s)e.o(s,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:s[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.i18n,s=window.wp.data,n=window.wp.components,r=window.wp.plugins,o=window.wp.editPost,i=window.moment;var a=e.n(i);window.wp.apiFetch;const l=window.wp.element;function u(e){if("object"==typeof GatherPress)return e.split(".").reduce(((e,t)=>e&&e[t]),GatherPress)}window.wp.date;const c=window.ReactJSXRuntime,d="YYYY-MM-DDTHH:mm:ss",g=a().tz(p()).add(1,"day").set("hour",18).set("minute",0).set("second",0).format(d);function p(e=u("eventDetails.dateTime.timezone")){return a().tz.zone(e)?e:(0,t.__)("GMT","gatherpress")}a().tz(g,p()).add(2,"hours").format(d);const h=()=>{const{editPost:e,unlockPostSaving:r}=(0,s.useDispatch)("core/editor"),o=(0,s.useSelect)((e=>e("core/editor").isCleanNewPost()),[]);let i=(0,s.useSelect)((e=>e("core/editor").getEditedPostAttribute("meta").gatherpress_enable_anonymous_rsvp),[]);o&&(i=u("settings.enableAnonymousRsvp"));const[a,d]=(0,l.useState)(i),g=(0,l.useCallback)((t=>{const s={gatherpress_enable_anonymous_rsvp:Number(t)};d(t),e({meta:s}),r()}),[e,r]);return(0,l.useEffect)((()=>{o&&0!==i&&g(i)}),[o,i,g]),(0,c.jsx)(n.CheckboxControl,{label:(0,t.__)("Enable Anonymous RSVP","gatherpress"),checked:a,onChange:e=>{g(e)}})},m=()=>(0,c.jsx)("section",{children:(0,c.jsx)(h,{})}),_=()=>{const{editPost:e,unlockPostSaving:r}=(0,s.useDispatch)("core/editor"),o=(0,s.useSelect)((e=>e("core/editor").isCleanNewPost()),[]);let i=(0,s.useSelect)((e=>e("core/editor").getEditedPostAttribute("meta").gatherpress_enable_initial_decline),[]);o&&(i=u("settings.enableInitialDecline"));const[a,d]=(0,l.useState)(i),g=(0,l.useCallback)((t=>{const s={gatherpress_enable_initial_decline:Number(t)};d(t),e({meta:s}),r()}),[e,r]);return(0,l.useEffect)((()=>{o&&0!==i&&g(i)}),[o,i,g]),(0,c.jsx)(n.CheckboxControl,{label:(0,t.__)('Enable Immediate "Not Attending" Option for Attendees',"gatherpress"),checked:a,onChange:e=>{g(e)}})},v=()=>(0,c.jsx)("section",{children:(0,c.jsx)(_,{})}),x=()=>(0,c.jsx)("section",{}),b=()=>{const{editPost:e,unlockPostSaving:r}=(0,s.useDispatch)("core/editor"),o=(0,s.useSelect)((e=>e("core/editor").isCleanNewPost()),[]);let i=(0,s.useSelect)((e=>e("core/editor").getEditedPostAttribute("meta").gatherpress_max_guest_limit),[]);o&&(i=u("settings.maxGuestLimit")),!1===i&&(i=0);const[a,d]=(0,l.useState)(i),g=(0,l.useCallback)((t=>{const s={gatherpress_max_guest_limit:Number(t)};d(t),e({meta:s}),r()}),[e,r]);return(0,l.useEffect)((()=>{o&&0!==i&&g(i)}),[o,i,g]),(0,c.jsx)(n.__experimentalNumberControl,{label:(0,t.__)("Maximum Number of Guests","gatherpress"),value:a,min:0,max:5,onChange:e=>{g(e)}})},S=()=>(0,c.jsx)("section",{children:(0,c.jsx)(b,{})}),j=()=>{const{editPost:e,unlockPostSaving:r}=(0,s.useDispatch)("core/editor"),o=(0,s.useSelect)((e=>e("core/editor").isCleanNewPost()),[]);let i=(0,s.useSelect)((e=>e("core/editor").getEditedPostAttribute("meta").gatherpress_max_attendance_limit),[]);o&&(i=u("settings.maxAttendanceLimit")),!1===i&&(i=0);const[a,d]=(0,l.useState)(i),g=(0,l.useCallback)((t=>{const s={gatherpress_max_attendance_limit:Number(t)};d(t),e({meta:s}),r()}),[e,r]);return(0,l.useEffect)((()=>{o&&0!==i&&g(i)}),[o,i,g]),(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.__experimentalNumberControl,{label:(0,t.__)("Maximum Attendance Limit","gatherpress"),value:a,min:0,onChange:e=>{g(e)}}),(0,c.jsx)("p",{className:"description",children:(0,t.__)("A value of 0 indicates no limit.","gatherpress")})]})},f=()=>(0,c.jsx)("section",{children:(0,c.jsx)(j,{})}),P=(e,t="")=>{for(const[s,n]of Object.entries(e)){let e=s;t&&(e+="_"+String(t));const r=new CustomEvent(e,{detail:n});dispatchEvent(r)}},w=(e,t="")=>{for(const[s,n]of Object.entries(e)){let e=s;t&&(e+="_"+String(t)),addEventListener(e,(e=>{n(e.detail)}),!1)}},C=()=>"publish"===(0,s.select)("core/editor").getEditedPostAttribute("status")&&!function(){const e=a().tz(u("eventDetails.dateTime.datetime_end"),p());return"gatherpress_event"===(0,s.select)("core/editor")?.getCurrentPostType()&&a().tz(p()).valueOf()>e.valueOf()}()&&(0,c.jsxs)("section",{children:[(0,c.jsx)("h3",{style:{marginBottom:"0.5rem"},children:(0,t.__)("Send an event update","gatherpress")}),(0,c.jsx)(n.Button,{variant:"secondary",onClick:()=>P({setOpen:!0}),children:(0,t.__)("Compose Message","gatherpress")})]}),E=()=>{const{editPost:e,unlockPostSaving:r}=(0,s.useDispatch)("core/editor"),o=(0,s.useSelect)((e=>e("core/editor").getEditedPostAttribute("meta").gatherpress_online_event_link)),[i,a]=(0,l.useState)(o);return w({setOnlineEventLink:a},u("eventDetails.postId")),(0,c.jsx)(n.TextControl,{label:(0,t.__)("Online event link","gatherpress"),value:i,placeholder:(0,t.__)("Add link to online event","gatherpress"),onChange:t=>{(t=>{e({meta:{gatherpress_online_event_link:t}}),a(t),P({setOnlineEventLink:t},u("eventDetails.postId")),r()})(t)}})},N=()=>(0,c.jsx)("section",{children:(0,c.jsx)(E,{})}),k=()=>{const[e,r]=(0,l.useState)(""),[o,i]=(0,l.useState)(""),[a,u]=(0,l.useState)(""),[d,g]=(0,l.useState)(""),[p,h]=(0,l.useState)(!1),[m,_]=(0,l.useState)(""),[v,x]=(0,l.useState)(""),[b,S]=(0,l.useState)(""),j=(0,s.useDispatch)("core/editor").editPost,{unlockPostSaving:f}=(0,s.useDispatch)("core/editor"),w=(0,s.useSelect)((e=>e("core/editor").getEditedPostAttribute("_gatherpress_venue"))),C=(0,s.useSelect)((e=>e("core").getEntityRecord("taxonomy","_gatherpress_venue",w))),E=C?.slug.replace(/^_/,""),[N,k]=(0,l.useState)(""),y=w+":"+N,A=(0,s.useSelect)((e=>e("core").getEntityRecords("postType","gatherpress_venue",{per_page:1,slug:N})));(0,l.useEffect)((()=>{var e,s,n,o,a,l;let c={};if(N&&Array.isArray(A)){var d;const e=null!==(d=A[0]?.meta?.gatherpress_venue_information)&&void 0!==d?d:"{}";var p;e&&(c=JSON.parse(e),c.name=null!==(p=A[0]?.title.rendered)&&void 0!==p?p:"")}const h=null!==(e=c?.name)&&void 0!==e?e:(0,t.__)("No venue selected.","gatherpress"),m=null!==(s=c?.fullAddress)&&void 0!==s?s:"",v=null!==(n=c?.phoneNumber)&&void 0!==n?n:"",b=null!==(o=c?.website)&&void 0!==o?o:"",j=null!==(a=c?.latitude)&&void 0!==a?a:"0",f=null!==(l=c?.longitude)&&void 0!==l?l:"0";E&&k(E),S(y?String(y):""),r(h),i(m),u(v),g(b),_(j),x(f),P({setName:h,setFullAddress:m,setPhoneNumber:v,setWebsite:b,setLatitude:j,setLongitude:f,setIsOnlineEventTerm:"online-event"===N})}),[N,A,E,y]);let O=(0,s.useSelect)((e=>e("core").getEntityRecords("taxonomy","_gatherpress_venue",{per_page:-1,context:"view"})),[]);return O?(O=O.map((e=>({label:e.name,value:e.id+":"+e.slug.replace(/^_/,"")}))),O.unshift({value:":",label:(0,t.__)("Choose a venue","gatherpress")})):O=[],(0,c.jsx)(n.PanelRow,{children:(0,c.jsx)(n.SelectControl,{label:(0,t.__)("Venue Selector","gatherpress"),value:b,onChange:e=>{(e=>{S(e);const t=""!==(e=e.split(":"))[0]?[e[0]]:[];j({_gatherpress_venue:t}),k(e[1]),f()})(e)},options:O})})},y=()=>(0,c.jsx)("section",{children:(0,c.jsx)(k,{})});(0,r.registerPlugin)("gatherpress-event-settings",{render:()=>"gatherpress_event"===(0,s.select)("core/editor")?.getCurrentPostType()&&(0,c.jsx)(o.PluginDocumentSettingPanel,{name:"gatherpress-event-settings",title:(0,t.__)("Event settings","gatherpress"),initialOpen:!0,className:"gatherpress-event-settings",children:(0,c.jsxs)(n.__experimentalVStack,{spacing:6,children:[(0,c.jsx)(x,{}),(0,c.jsx)(y,{}),(0,c.jsx)(N,{}),(0,c.jsx)(S,{}),(0,c.jsx)(f,{}),(0,c.jsx)(m,{}),(0,c.jsx)(v,{}),(0,c.jsx)(C,{})]})})}),(0,s.dispatch)("core/edit-post").toggleEditorPanelOpened("gatherpress-event-settings/gatherpress-event-settings");const A=window.wp.compose,O=()=>{var e,r,o;const i=(0,s.useDispatch)("core/editor").editPost,a=e=>{const t=JSON.stringify({...u,...e});i({meta:{gatherpress_venue_information:t}})};let u=(0,s.useSelect)((e=>e("core/editor").getEditedPostAttribute("meta").gatherpress_venue_information));u=u?JSON.parse(u):{};const[d,g]=(0,l.useState)(null!==(e=u.fullAddress)&&void 0!==e?e:""),[p,h]=(0,l.useState)(null!==(r=u.phoneNumber)&&void 0!==r?r:""),[m,_]=(0,l.useState)(null!==(o=u.website)&&void 0!==o?o:"");w({setFullAddress:g,setPhoneNumber:h,setWebsite:_});const v=(0,l.useRef)(a),x=(0,l.useCallback)((()=>{let e=null,s=null;fetch(`https://nominatim.openstreetmap.org/search?q=${d}&format=geojson`).then((e=>{if(!e.ok)throw new Error((0,t.sprintf)(/* translators: %s: Error message */ /* translators: %s: Error message */
(0,t.__)("Network response was not ok %s","gatherpress"),e.statusText));return e.json()})).then((t=>{t.features.length>0&&(e=t.features[0].geometry.coordinates[1],s=t.features[0].geometry.coordinates[0]),v.current({latitude:e,longitude:s})}))}),[d]),b=(0,A.useDebounce)(x,300);return(0,l.useEffect)((()=>{v.current=a}),[a]),(0,l.useEffect)((()=>{b()}),[d,b]),(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.TextControl,{label:(0,t.__)("Full Address","gatherpress"),value:d,onChange:e=>{P({setFullAddress:e}),a({fullAddress:e})}}),(0,c.jsx)(n.TextControl,{label:(0,t.__)("Phone Number","gatherpress"),value:p,onChange:e=>{P({setPhoneNumber:e}),a({phoneNumber:e})}}),(0,c.jsx)(n.TextControl,{label:(0,t.__)("Website","gatherpress"),value:m,type:"url",onChange:e=>{P({setWebsite:e}),a({website:e})}})]})},D=()=>(0,c.jsx)("section",{children:(0,c.jsx)(O,{})});(0,r.registerPlugin)("gatherpress-venue-settings",{render:()=>"gatherpress_venue"===(0,s.select)("core/editor")?.getCurrentPostType()&&(0,c.jsx)(o.PluginDocumentSettingPanel,{name:"gatherpress-venue-settings",title:(0,t.__)("Venue settings","gatherpress"),initialOpen:!0,className:"gatherpress-venue-settings",children:(0,c.jsx)(n.__experimentalVStack,{spacing:6,children:(0,c.jsx)(D,{})})})}),(0,s.dispatch)("core/edit-post").toggleEditorPanelOpened("gatherpress-venue-settings/gatherpress-venue-settings")})();