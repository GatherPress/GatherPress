(()=>{"use strict";var e={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},d:(t,s)=>{for(var n in s)e.o(s,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:s[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.i18n,s=window.wp.data,n=window.wp.components,r=window.wp.plugins,a=window.wp.editPost,i=window.moment;var o=e.n(i);const l=window.wp.element;function d(){(0,s.dispatch)("core/editor")?.editPost({meta:{_non_existing_meta:!0}})}function c(e){if("object"==typeof GatherPress)return e.split(".").reduce(((e,t)=>e&&e[t]),GatherPress)}function u(e,t){if("object"!=typeof GatherPress)return;const s=e.split("."),n=s.pop();s.reduce(((e,t)=>{var s;return null!==(s=e[t])&&void 0!==s?s:e[t]={}}),GatherPress)[n]=t}const m=window.wp.date,p=window.ReactJSXRuntime,g="YYYY-MM-DDTHH:mm:ss",h="YYYY-MM-DD HH:mm:ss",_=o().tz(f()).add(1,"day").set("hour",18).set("minute",0).set("second",0).format(g),v=o().tz(_,f()).add(2,"hours").format(g);function x(){return T(c("settings.dateFormat"))+" "+T(c("settings.timeFormat"))}function f(e=c("eventDetails.dateTime.timezone")){return o().tz.zone(e)?e:(0,t.__)("GMT","gatherpress")}function j(e=""){const t=/^([+-])(\d{2}):(00|15|30|45)$/,s=e.replace(t,"$1");return s!==e?"UTC"+s+parseInt(e.replace(t,"$2")).toString()+e.replace(t,"$3").replace("00","").replace("15",".25").replace("30",".5").replace("45",".75"):e}function S(e,t=null){!function(e){const t=o().tz(c("eventDetails.dateTime.datetime_end"),f()).valueOf(),s=o().tz(e,f()).valueOf();s>=t&&b(o().tz(s,f()).add(2,"hours").format(g))}(e),u("eventDetails.dateTime.datetime_start",e),"function"==typeof t&&t(e),d()}function b(e,t=null){!function(e){const t=o().tz(c("eventDetails.dateTime.datetime_start"),f()).valueOf(),s=o().tz(e,f()).valueOf();s<=t&&S(o().tz(s,f()).subtract(2,"hours").format(g))}(e),u("eventDetails.dateTime.datetime_end",e),null!==t&&t(e),d()}function T(e){const t={d:"DD",D:"ddd",j:"D",l:"dddd",N:"E",S:"o",w:"e",z:"DDD",W:"W",F:"MMMM",m:"MM",M:"MMM",n:"M",t:"",L:"",o:"YYYY",Y:"YYYY",y:"YY",a:"a",A:"A",B:"",g:"h",G:"H",h:"hh",H:"HH",i:"mm",s:"ss",u:"SSS",e:"zz",I:"",O:"",P:"",T:"",Z:"",c:"",r:"",U:"X"};return String(e).split("").map(((e,s,n)=>{const r=n[s-1];return e in t&&"\\"!==r?t[e]:e})).join("")}function P(){const e=o().tz(c("eventDetails.dateTime.datetime_end"),f());return"gatherpress_event"===(0,s.select)("core/editor")?.getCurrentPostType()&&o().tz(f()).valueOf()>e.valueOf()}function D(){const e="gatherpress_event_past",n=(0,s.dispatch)("core/notices");n.removeNotice(e),P()&&n.createNotice("warning",(0,t.__)("This event has already passed.","gatherpress"),{id:e,isDismissible:!1})}const w=()=>{const{editPost:e,unlockPostSaving:r}=(0,s.useDispatch)("core/editor"),a=(0,s.useSelect)((e=>e("core/editor").isCleanNewPost()),[]);let i=(0,s.useSelect)((e=>e("core/editor").getEditedPostAttribute("meta").gatherpress_enable_anonymous_rsvp),[]);a&&(i=c("settings.enableAnonymousRsvp"));const[o,d]=(0,l.useState)(i),u=(0,l.useCallback)((t=>{const s={gatherpress_enable_anonymous_rsvp:Number(t)};d(t),e({meta:s}),r()}),[e,r]);return(0,l.useEffect)((()=>{a&&0!==i&&u(i)}),[a,i,u]),(0,p.jsx)(n.CheckboxControl,{label:(0,t.__)("Enable Anonymous RSVP","gatherpress"),checked:o,onChange:e=>{u(e)}})},E=()=>(0,p.jsx)("section",{children:(0,p.jsx)(w,{})}),C=()=>{const{editPost:e,unlockPostSaving:r}=(0,s.useDispatch)("core/editor"),a=(0,s.useSelect)((e=>e("core/editor").isCleanNewPost()),[]);let i=(0,s.useSelect)((e=>e("core/editor").getEditedPostAttribute("meta").gatherpress_enable_initial_decline),[]);a&&(i=c("settings.enableInitialDecline"));const[o,d]=(0,l.useState)(i),u=(0,l.useCallback)((t=>{const s={gatherpress_enable_initial_decline:Number(t)};d(t),e({meta:s}),r()}),[e,r]);return(0,l.useEffect)((()=>{a&&0!==i&&u(i)}),[a,i,u]),(0,p.jsx)(n.CheckboxControl,{label:(0,t.__)('Enable Immediate "Not Attending" Option for Attendees',"gatherpress"),checked:o,onChange:e=>{u(e)}})},k=()=>(0,p.jsx)("section",{children:(0,p.jsx)(C,{})}),y=e=>{const{dateTimeStart:t}=e;return o().tz(t,f()).format(x())},z=e=>{const{dateTimeEnd:t}=e;return o().tz(t,f()).format(x())},N=e=>{const{dateTimeStart:t,setDateTimeStart:s}=e,r=(0,m.getSettings)(),a=/a(?!\\)/i.test(r.formats.time.toLowerCase().replace(/\\\\/g,"").split("").reverse().join(""));return(0,p.jsx)(n.DateTimePicker,{currentDate:t,onChange:e=>{S(e,s)},is12Hour:a})},O=e=>{const{dateTimeEnd:t,setDateTimeEnd:s}=e,r=(0,m.getSettings)(),a=/a(?!\\)/i.test(r.formats.time.toLowerCase().replace(/\\\\/g,"").split("").reverse().join(""));return(0,p.jsx)(n.DateTimePicker,{currentDate:t,onChange:e=>b(e,s),is12Hour:a})},A=()=>{const{dateTimeStart:e}=(0,s.useSelect)((e=>({dateTimeStart:e("gatherpress/datetime").getDateTimeStart()})),[]),{setDateTimeStart:r}=(0,s.useDispatch)("gatherpress/datetime");return(0,l.useEffect)((()=>{r(o().tz(function(){let e=c("eventDetails.dateTime.datetime_start");return e=""!==e?o().tz(e,f()).format(g):_,u("eventDetails.dateTime.datetime_start",e),e}(),f()).format(g)),D()})),(0,p.jsx)(n.PanelRow,{children:(0,p.jsxs)(n.Flex,{direction:"row",gap:"0",children:[(0,p.jsx)(n.FlexItem,{children:(0,p.jsx)("label",{htmlFor:"gatherpress-datetime-start",children:(0,t.__)("Start","gatherpress")})}),(0,p.jsx)(n.FlexItem,{children:(0,p.jsx)(n.Dropdown,{popoverProps:{placement:"bottom-end"},renderToggle:({isOpen:t,onToggle:s})=>(0,p.jsx)(n.Button,{id:"gatherpress-datetime-start",onClick:s,"aria-expanded":t,isLink:!0,children:(0,p.jsx)(y,{dateTimeStart:e})}),renderContent:()=>(0,p.jsx)(N,{dateTimeStart:e,setDateTimeStart:r})})})]})})},M=()=>{const{dateTimeEnd:e}=(0,s.useSelect)((e=>({dateTimeEnd:e("gatherpress/datetime").getDateTimeEnd()})),[]),{setDateTimeEnd:r}=(0,s.useDispatch)("gatherpress/datetime");return(0,l.useEffect)((()=>{r(o().tz(function(){let e=c("eventDetails.dateTime.datetime_end");return e=""!==e?o().tz(e,f()).format(g):v,u("eventDetails.dateTime.datetime_end",e),e}(),f()).format(g)),D()})),(0,p.jsx)(n.PanelRow,{children:(0,p.jsxs)(n.Flex,{direction:"row",gap:"0",children:[(0,p.jsx)(n.FlexItem,{children:(0,p.jsx)("label",{htmlFor:"gatherpress-datetime-end",children:(0,t.__)("End","gatherpress")})}),(0,p.jsx)(n.FlexItem,{children:(0,p.jsx)(n.Dropdown,{popoverProps:{placement:"bottom-end"},renderToggle:({isOpen:t,onToggle:s})=>(0,p.jsx)(n.Button,{id:"gatherpress-datetime-end",onClick:s,"aria-expanded":t,isLink:!0,children:(0,p.jsx)(z,{dateTimeEnd:e})}),renderContent:()=>(0,p.jsx)(O,{dateTimeEnd:e,setDateTimeEnd:r})})})]})})},Y=()=>{const{timezone:e}=(0,s.useSelect)((e=>({timezone:e("gatherpress/datetime").getTimezone()})),[]),{setTimezone:r}=(0,s.useDispatch)("gatherpress/datetime"),a=c("misc.timezoneChoices");return(0,l.useEffect)((()=>{r(c("eventDetails.dateTime.timezone"))}),[r]),(0,p.jsx)(n.PanelRow,{children:(0,p.jsx)(n.SelectControl,{label:(0,t.__)("Time Zone","gatherpress"),value:j(e),onChange:e=>{e=function(e=""){const t=/^UTC([+-])(\d+)(.\d+)?$/,s=e.replace(t,"$1");if(s!==e){const n=e.replace(t,"$2").padStart(2,"0");let r=e.replace(t,"$3");return""===r&&(r=":00"),r=r.replace(".25",":15").replace(".5",":30").replace(".75",":45"),s+n+r}return e}(e),r(e),d()},children:Object.keys(a).map((e=>(0,p.jsx)("optgroup",{label:e,children:Object.keys(a[e]).map((t=>(0,p.jsx)("option",{value:t,children:a[e][t]},t)))},e)))})})},F=()=>{const e=(0,s.useDispatch)("core/editor").editPost;let n=(0,s.useSelect)((e=>e("core/editor").getEditedPostAttribute("meta")?.gatherpress_datetime));try{n=n?JSON.parse(n):{}}catch(e){n={}}const{dateTimeStart:r,dateTimeEnd:a,timezone:i}=(0,s.useSelect)((e=>({dateTimeStart:e("gatherpress/datetime").getDateTimeStart(),dateTimeEnd:e("gatherpress/datetime").getDateTimeEnd(),timezone:e("gatherpress/datetime").getTimezone()})),[]);return(0,l.useEffect)((()=>{const t=JSON.stringify({...n,dateTimeStart:o().tz(r,i).format(h),dateTimeEnd:o().tz(a,i).format(h),timezone:i});e({meta:{gatherpress_datetime:t}})}),[r,a,i,n,e]),(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("h3",{children:(0,t.__)("Date & time","gatherpress")}),(0,p.jsx)(A,{}),(0,p.jsx)(M,{}),(0,p.jsx)(Y,{})]})},L=()=>(0,p.jsx)("section",{children:(0,p.jsx)(F,{})}),R=()=>{const{editPost:e,unlockPostSaving:r}=(0,s.useDispatch)("core/editor"),a=(0,s.useSelect)((e=>e("core/editor").isCleanNewPost()),[]);let i=(0,s.useSelect)((e=>e("core/editor").getEditedPostAttribute("meta").gatherpress_max_guest_limit),[]);a&&(i=c("settings.maxGuestLimit")),!1===i&&(i=0);const[o,d]=(0,l.useState)(i),u=(0,l.useCallback)((t=>{const s={gatherpress_max_guest_limit:Number(t)};d(t),e({meta:s}),r()}),[e,r]);return(0,l.useEffect)((()=>{a&&0!==i&&u(i)}),[a,i,u]),(0,p.jsx)(n.__experimentalNumberControl,{label:(0,t.__)("Maximum Number of Guests","gatherpress"),value:o,min:0,max:5,onChange:e=>{u(e)}})},I=()=>(0,p.jsx)("section",{children:(0,p.jsx)(R,{})}),H=()=>{const{editPost:e,unlockPostSaving:r}=(0,s.useDispatch)("core/editor"),a=(0,s.useSelect)((e=>e("core/editor").isCleanNewPost()),[]);let i=(0,s.useSelect)((e=>e("core/editor").getEditedPostAttribute("meta").gatherpress_max_attendance_limit),[]);a&&(i=c("settings.maxAttendanceLimit")),!1===i&&(i=0);const[o,d]=(0,l.useState)(i),u=(0,l.useCallback)((t=>{const s={gatherpress_max_attendance_limit:Number(t)};d(t),e({meta:s}),r()}),[e,r]);return(0,l.useEffect)((()=>{a&&0!==i&&u(i)}),[a,i,u]),(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(n.__experimentalNumberControl,{label:(0,t.__)("Maximum Attendance Limit","gatherpress"),value:o,min:0,onChange:e=>{u(e)}}),(0,p.jsx)("p",{className:"description",children:(0,t.__)("A value of 0 indicates no limit.","gatherpress")})]})},$=()=>(0,p.jsx)("section",{children:(0,p.jsx)(H,{})}),G=(e,t="")=>{for(const[s,n]of Object.entries(e)){let e=s;t&&(e+="_"+String(t));const r=new CustomEvent(e,{detail:n});dispatchEvent(r)}},J=(e,t="")=>{for(const[s,n]of Object.entries(e)){let e=s;t&&(e+="_"+String(t)),addEventListener(e,(e=>{n(e.detail)}),!1)}},W=()=>"publish"===(0,s.select)("core/editor").getEditedPostAttribute("status")&&!P()&&(0,p.jsxs)("section",{children:[(0,p.jsx)("h3",{style:{marginBottom:"0.5rem"},children:(0,t.__)("Send an event update","gatherpress")}),(0,p.jsx)(n.Button,{variant:"secondary",onClick:()=>G({setOpen:!0}),children:(0,t.__)("Compose Message","gatherpress")})]}),B=()=>{const{editPost:e,unlockPostSaving:r}=(0,s.useDispatch)("core/editor"),a=(0,s.useSelect)((e=>e("core/editor").getEditedPostAttribute("meta").gatherpress_online_event_link)),[i,o]=(0,l.useState)(a);return J({setOnlineEventLink:o},c("eventDetails.postId")),(0,p.jsx)(n.TextControl,{label:(0,t.__)("Online event link","gatherpress"),value:i,placeholder:(0,t.__)("Add link to online event","gatherpress"),onChange:t=>{(t=>{e({meta:{gatherpress_online_event_link:t}}),o(t),G({setOnlineEventLink:t},c("eventDetails.postId")),r()})(t)}})},V=()=>(0,p.jsx)("section",{children:(0,p.jsx)(B,{})}),U=()=>{const[e,r]=(0,l.useState)(""),[a,i]=(0,l.useState)(""),[o,d]=(0,l.useState)(""),[c,u]=(0,l.useState)(""),[m,g]=(0,l.useState)(!1),[h,_]=(0,l.useState)(""),[v,x]=(0,l.useState)(""),[f,j]=(0,l.useState)(""),S=(0,s.useDispatch)("core/editor").editPost,{unlockPostSaving:b}=(0,s.useDispatch)("core/editor"),T=(0,s.useSelect)((e=>e("core/editor").getEditedPostAttribute("_gatherpress_venue"))),P=(0,s.useSelect)((e=>e("core").getEntityRecord("taxonomy","_gatherpress_venue",T))),D=P?.slug.replace(/^_/,""),[w,E]=(0,l.useState)(""),C=T+":"+w,k=(0,s.useSelect)((e=>e("core").getEntityRecords("postType","gatherpress_venue",{per_page:1,slug:w})));(0,l.useEffect)((()=>{var e,s,n,a,o,l;let c={};if(w&&Array.isArray(k)){var m;const e=null!==(m=k[0]?.meta?.gatherpress_venue_information)&&void 0!==m?m:"{}";var p;e&&(c=JSON.parse(e),c.name=null!==(p=k[0]?.title.rendered)&&void 0!==p?p:"")}const g=null!==(e=c?.name)&&void 0!==e?e:(0,t.__)("No venue selected.","gatherpress"),h=null!==(s=c?.fullAddress)&&void 0!==s?s:"",v=null!==(n=c?.phoneNumber)&&void 0!==n?n:"",f=null!==(a=c?.website)&&void 0!==a?a:"",S=null!==(o=c?.latitude)&&void 0!==o?o:"0",b=null!==(l=c?.longitude)&&void 0!==l?l:"0";D&&E(D),j(C?String(C):""),r(g),i(h),d(v),u(f),_(S),x(b),G({setName:g,setFullAddress:h,setPhoneNumber:v,setWebsite:f,setLatitude:S,setLongitude:b,setIsOnlineEventTerm:"online-event"===w})}),[w,k,D,C]);let y=(0,s.useSelect)((e=>e("core").getEntityRecords("taxonomy","_gatherpress_venue",{per_page:-1,context:"view"})),[]);return y?(y=y.map((e=>({label:e.name,value:e.id+":"+e.slug.replace(/^_/,"")}))),y.unshift({value:":",label:(0,t.__)("Choose a venue","gatherpress")})):y=[],(0,p.jsx)(n.PanelRow,{children:(0,p.jsx)(n.SelectControl,{label:(0,t.__)("Venue Selector","gatherpress"),value:f,onChange:e=>{(e=>{j(e);const t=""!==(e=e.split(":"))[0]?[e[0]]:[];S({_gatherpress_venue:t}),E(e[1]),b()})(e)},options:y})})},X=()=>(0,p.jsx)("section",{children:(0,p.jsx)(U,{})});(0,r.registerPlugin)("gatherpress-event-settings",{render:()=>"gatherpress_event"===(0,s.select)("core/editor")?.getCurrentPostType()&&(0,p.jsx)(a.PluginDocumentSettingPanel,{name:"gatherpress-event-settings",title:(0,t.__)("Event settings","gatherpress"),initialOpen:!0,className:"gatherpress-event-settings",children:(0,p.jsxs)(n.__experimentalVStack,{spacing:6,children:[(0,p.jsx)(L,{}),(0,p.jsx)(X,{}),(0,p.jsx)(V,{}),(0,p.jsx)(I,{}),(0,p.jsx)($,{}),(0,p.jsx)(E,{}),(0,p.jsx)(k,{}),(0,p.jsx)(W,{})]})})}),(0,s.dispatch)("core/edit-post").toggleEditorPanelOpened("gatherpress-event-settings/gatherpress-event-settings");const Z=window.wp.compose,q=()=>{var e,r,a;const i=(0,s.useDispatch)("core/editor").editPost,o=e=>{const t=JSON.stringify({...d,...e});i({meta:{gatherpress_venue_information:t}})};let d=(0,s.useSelect)((e=>e("core/editor").getEditedPostAttribute("meta").gatherpress_venue_information));d=d?JSON.parse(d):{};const[c,u]=(0,l.useState)(null!==(e=d.fullAddress)&&void 0!==e?e:""),[m,g]=(0,l.useState)(null!==(r=d.phoneNumber)&&void 0!==r?r:""),[h,_]=(0,l.useState)(null!==(a=d.website)&&void 0!==a?a:"");J({setFullAddress:u,setPhoneNumber:g,setWebsite:_});const v=(0,l.useRef)(o),x=(0,l.useCallback)((()=>{let e=null,s=null;fetch(`https://nominatim.openstreetmap.org/search?q=${c}&format=geojson`).then((e=>{if(!e.ok)throw new Error((0,t.sprintf)(/* translators: %s: Error message */ /* translators: %s: Error message */
(0,t.__)("Network response was not ok %s","gatherpress"),e.statusText));return e.json()})).then((t=>{t.features.length>0&&(e=t.features[0].geometry.coordinates[1],s=t.features[0].geometry.coordinates[0]),v.current({latitude:e,longitude:s})}))}),[c]),f=(0,Z.useDebounce)(x,300);return(0,l.useEffect)((()=>{v.current=o}),[o]),(0,l.useEffect)((()=>{f()}),[c,f]),(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(n.TextControl,{label:(0,t.__)("Full Address","gatherpress"),value:c,onChange:e=>{G({setFullAddress:e}),o({fullAddress:e})}}),(0,p.jsx)(n.TextControl,{label:(0,t.__)("Phone Number","gatherpress"),value:m,onChange:e=>{G({setPhoneNumber:e}),o({phoneNumber:e})}}),(0,p.jsx)(n.TextControl,{label:(0,t.__)("Website","gatherpress"),value:h,type:"url",onChange:e=>{G({setWebsite:e}),o({website:e})}})]})},K=()=>(0,p.jsx)("section",{children:(0,p.jsx)(q,{})});(0,r.registerPlugin)("gatherpress-venue-settings",{render:()=>"gatherpress_venue"===(0,s.select)("core/editor")?.getCurrentPostType()&&(0,p.jsx)(a.PluginDocumentSettingPanel,{name:"gatherpress-venue-settings",title:(0,t.__)("Venue settings","gatherpress"),initialOpen:!0,className:"gatherpress-venue-settings",children:(0,p.jsx)(n.__experimentalVStack,{spacing:6,children:(0,p.jsx)(K,{})})})}),(0,s.dispatch)("core/edit-post").toggleEditorPanelOpened("gatherpress-venue-settings/gatherpress-venue-settings")})();