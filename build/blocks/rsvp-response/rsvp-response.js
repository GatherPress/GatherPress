(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var s in n)e.o(n,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:n[s]})}};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);const t=window.React,n=window.wp.domReady;var s=e.n(n);const a=window.wp.element,r=window.wp.i18n,i=window.wp.components,l=(e,t="")=>{for(const[n,s]of Object.entries(e)){let e=n;t&&(e+="_"+String(t)),addEventListener(e,(e=>{s(e.detail)}),!1)}};function o(e){if("object"==typeof GatherPress)return e.split(".").reduce(((e,t)=>e&&e[t]),GatherPress)}window.wp.data;const c=({item:e,activeItem:n=!1,count:s,onTitleClick:r,defaultLimit:i})=>{const{title:l,value:c}=e,p=!(0===s&&"attending"!==c),m=n?"span":"a",d=o("post_id"),v=s>i;return(0,a.useEffect)((()=>{n&&((e,t="")=>{for(const[n,s]of Object.entries(e)){let e=n;t&&(e+="_"+String(t));const a=new CustomEvent(e,{detail:s});dispatchEvent(a)}})({setRsvpSeeAllLink:v},d)})),p?(0,t.createElement)("div",{className:"gp-rsvp-response__navigation-item"},(0,t.createElement)(m,{className:"gp-rsvp-response__anchor","data-item":c,"data-toggle":"tab",href:"#",role:"tab","aria-controls":`#gp-rsvp-${c}`,onClick:e=>r(e,c)},l),(0,t.createElement)("span",{className:"gp-rsvp-response__count"},"(",s,")")):""},p=({items:n,activeValue:s,onTitleClick:r,defaultLimit:i})=>{const p={all:0,attending:0,not_attending:0,waiting_list:0};for(const[e,t]of Object.entries(o("responses")))p[e]=t.count;const[m,d]=(0,a.useState)(p),[v,u]=(0,a.useState)(!1),[g,_]=(0,a.useState)(!0),E=g?"span":"a";l({setRsvpCount:d},o("post_id"));let f=0;const h=n.map(((e,n)=>{const a=e.value===s;return a&&(f=n),(0,t.createElement)(c,{key:n,item:e,count:m[e.value],activeItem:a,onTitleClick:r,defaultLimit:i})}));return(0,a.useEffect)((()=>{e.g.document.addEventListener("click",(({target:e})=>{e.closest(".gp-rsvp-response__navigation-active")||u(!1)})),e.g.document.addEventListener("keydown",(({key:e})=>{"Escape"===e&&u(!1)}))})),(0,a.useEffect)((()=>{0===m.not_attending&&0===m.waiting_list?_(!0):_(!1)}),[m]),(0,t.createElement)("div",{className:"gp-rsvp-response__navigation-wrapper"},(0,t.createElement)("div",null,(0,t.createElement)(E,{href:"#",className:"gp-rsvp-response__navigation-active",onClick:e=>(e=>{e.preventDefault(),u(!v)})(e)},n[f].title),"Â ",(0,t.createElement)("span",null,"(",m[s],")")),!g&&v&&(0,t.createElement)("nav",{className:"gp-rsvp-response__navigation"},h))},m=({items:e,activeValue:n,onTitleClick:s,rsvpLimit:i,setRsvpLimit:c,defaultLimit:m})=>{let d;d=!1===i?(0,r.__)("See fewer","gatherpress"):(0,r.__)("See all","gatherpress");const[v,u]=(0,a.useState)(o("responses")[n].count>m);return l({setRsvpSeeAllLink:u},o("post_id")),(0,t.createElement)("div",{className:"gp-rsvp-response__header"},(0,t.createElement)("div",{className:"dashicons dashicons-groups"}),(0,t.createElement)(p,{items:e,activeValue:n,onTitleClick:s,defaultLimit:m}),v&&(0,t.createElement)("div",{className:"gp-rsvp-response__see-all"},(0,t.createElement)("a",{href:"#",onClick:e=>(e=>{e.preventDefault(),c(!1===i&&m)})(e)},d)))},d=({value:e,limit:n,responses:s=[]})=>{let a="";return"object"==typeof s&&void 0!==s[e]&&(s=[...s[e].responses],n&&(s=s.splice(0,n)),a=s.map(((e,n)=>{const{profile:s,name:a,photo:r,role:i}=e;let{guests:l}=e;return l=l?" +"+l+" guest(s)":"",(0,t.createElement)("div",{key:n,className:"gp-rsvp-response__item"},(0,t.createElement)("figure",{className:"gp-rsvp-response__member-avatar"},(0,t.createElement)("a",{href:s},(0,t.createElement)("img",{alt:a,title:a,src:r}))),(0,t.createElement)("div",{className:"gp-rsvp-response__member-info"},(0,t.createElement)("div",{className:"gp-rsvp-response__member-name"},(0,t.createElement)("a",{href:s,title:a},a)),(0,t.createElement)("div",{className:"gp-rsvp-response__member-role"},i),(0,t.createElement)("small",{className:"gp-rsvp-response__guests"},l)))}))),(0,t.createElement)(t.Fragment,null,"attending"===e&&0===a.length&&(0,t.createElement)("div",{className:"gp-rsvp-response__no-responses"},!1===o("has_event_past")?(0,r.__)("No one is attending this event yet.","gatherpress"):(0,r.__)("No one went to this event.","gatherpress")),a)},v=({items:e,activeValue:n,limit:s=!1,editMode:r})=>{const c=o("post_id"),[p,m]=(0,a.useState)(o("responses")),v=[{name:"Attendees",triggerPrefix:"~",options:p.attending.responses,getOptionLabel:e=>(0,t.createElement)("span",null,(0,t.createElement)("span",{className:"icon"},e.visual),e.name),getOptionKeywords:e=>[e.name],isOptionDisabled:e=>"admin"===e.name,getOptionCompletion:e=>(0,t.createElement)("abbr",{title:e.name},e.visual)}];l({setRsvpResponse:m},c);const u=e.map(((e,a)=>{const{value:l}=e;return l===n?(0,t.createElement)("div",{key:a,className:"gp-rsvp-response__items",id:`gp-rsvp-${l}`,role:"tabpanel","aria-labelledby":`gp-rsvp-${l}-tab`},(0,t.createElement)(i.Autocomplete,{completers:v},(({listBoxId:e,activeId:n,onChange:s})=>(0,t.createElement)("div",null,(0,t.createElement)("input",{onChange:s,"aria-controls":e,"aria-activedescendant":n}),(0,t.createElement)("ul",{id:e})))),!r&&(0,t.createElement)(d,{value:l,limit:s,responses:p}),r&&(0,t.createElement)("div",null,(0,t.createElement)(i.Autocomplete,{completers:v},(({listBoxId:e,activeId:n,onChange:s})=>(0,t.createElement)("div",null,(0,t.createElement)("input",{onChange:s,"aria-controls":e,"aria-activedescendant":n}),(0,t.createElement)("ul",{id:e})))))):""}));return(0,t.createElement)("div",{className:"gp-rsvp-response__content"},u)},u=()=>{const e=o("has_event_past"),n=[{title:!1===e?(0,r.__)("Attending","gatherpress"):(0,r.__)("Went","gatherpress"),value:"attending"},{title:!1===e?(0,r.__)("Waiting List","gatherpress"):(0,r.__)("Wait Listed","gatherpress"),value:"waiting_list"},{title:!1===e?(0,r.__)("Not Attending","gatherpress"):(0,r.__)("Didn't Go","gatherpress"),value:"not_attending"}],[s,c]=(0,a.useState)("attending"),[p,d]=(0,a.useState)(8),[u,g]=(0,a.useState)(!1);l({setRsvpStatus:c},o("post_id"));const _=o("current_user").is_admin;return(0,t.createElement)("div",{className:"gp-rsvp-response"},(0,t.createElement)(m,{items:n,activeValue:s,onTitleClick:(e,t)=>{e.preventDefault(),c(t)},rsvpLimit:p,setRsvpLimit:d,defaultLimit:8}),_&&(0,t.createElement)(i.Button,{variant:"secondary",onClick:e=>{e.preventDefault(),g(!u)}},"Edit Attendees"),(0,t.createElement)(v,{items:n,activeValue:s,limit:p,editMode:u}))};s()((()=>{const e=document.querySelectorAll('[data-gp_block_name="rsvp-response"]');for(let n=0;n<e.length;n++)(0,a.createRoot)(e[n]).render((0,t.createElement)(u,null))}))})();