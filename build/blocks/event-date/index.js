(()=>{"use strict";var e,t={3358:(e,t,r)=>{const n=window.wp.blocks,s=window.moment;var i=r.n(s);function a(e){var t,r,n="";if("string"==typeof e||"number"==typeof e)n+=e;else if("object"==typeof e)if(Array.isArray(e)){var s=e.length;for(t=0;t<s;t++)e[t]&&(r=a(e[t]))&&(n&&(n+=" "),n+=r)}else for(r in e)e[r]&&(n&&(n+=" "),n+=r);return n}const o=function(){for(var e,t,r=0,n="",s=arguments.length;r<s;r++)(e=arguments[r])&&(t=a(e))&&(n&&(n+=" "),n+=t);return n},l=window.wp.i18n,d=window.wp.blockEditor,c=window.wp.components,m=window.wp.element,p=(e,t="")=>{for(const[r,n]of Object.entries(e)){let e=r;t&&(e+="_"+String(t));const s=new CustomEvent(e,{detail:n});dispatchEvent(s)}},u=window.wp.data,f=window.wp.apiFetch;var h=r.n(f);function g(){(0,u.dispatch)("core/editor")?.editPost({meta:{_non_existing_meta:!0}})}function v(e){if("object"==typeof GatherPress)return e.split(".").reduce(((e,t)=>e&&e[t]),GatherPress)}function T(e,t){if("object"!=typeof GatherPress)return;const r=e.split("."),n=r.pop();r.reduce(((e,t)=>{var r;return null!==(r=e[t])&&void 0!==r?r:e[t]={}}),GatherPress)[n]=t}function x(){const e=i().tz(v("eventDetails.dateTime.datetime_end"),k());return"gatherpress_event"===(0,u.select)("core/editor")?.getCurrentPostType()&&i().tz(k()).valueOf()>e.valueOf()}function _(){const e="gatherpress_event_past",t=(0,u.dispatch)("core/notices");t.removeNotice(e),x()&&t.createNotice("warning",(0,l.__)("This event has already passed.","gatherpress"),{id:e,isDismissible:!1})}const D=window.wp.date,j=window.ReactJSXRuntime,w="YYYY-MM-DDTHH:mm:ss",y="YYYY-MM-DD HH:mm:ss",z=i().tz(k()).add(1,"day").set("hour",18).set("minute",0).set("second",0).format(w),S=i().tz(z,k()).add(2,"hours").format(w);function b(){return P(v("settings.dateFormat"))+" "+P(v("settings.timeFormat"))}function k(e=v("eventDetails.dateTime.timezone")){return i().tz.zone(e)?e:(0,l.__)("GMT","gatherpress")}function C(e=""){const t=/^([+-])(\d{2}):(00|15|30|45)$/,r=e.replace(t,"$1");return r!==e?"UTC"+r+parseInt(e.replace(t,"$2")).toString()+e.replace(t,"$3").replace("00","").replace("15",".25").replace("30",".5").replace("45",".75"):e}function O(e,t=null){!function(e){const t=i().tz(v("eventDetails.dateTime.datetime_end"),k()).valueOf(),r=i().tz(e,k()).valueOf();r>=t&&E(i().tz(r,k()).add(2,"hours").format(w))}(e),T("eventDetails.dateTime.datetime_start",e),"function"==typeof t&&t(e),g()}function E(e,t=null){!function(e){const t=i().tz(v("eventDetails.dateTime.datetime_start"),k()).valueOf(),r=i().tz(e,k()).valueOf();r<=t&&O(i().tz(r,k()).subtract(2,"hours").format(w))}(e),T("eventDetails.dateTime.datetime_end",e),null!==t&&t(e),g()}function P(e){const t={d:"DD",D:"ddd",j:"D",l:"dddd",N:"E",S:"o",w:"e",z:"DDD",W:"W",F:"MMMM",m:"MM",M:"MMM",n:"M",t:"",L:"",o:"YYYY",Y:"YYYY",y:"YY",a:"a",A:"A",B:"",g:"h",G:"H",h:"hh",H:"HH",i:"mm",s:"ss",u:"SSS",e:"zz",I:"",O:"",P:"",T:"",Z:"",c:"",r:"",U:"X"};return String(e).split("").map(((e,r,n)=>{const s=n[r-1];return e in t&&"\\"!==s?t[e]:e})).join("")}const F=e=>{const{dateTimeStart:t}=e;return i().tz(t,k()).format(b())},M=e=>{const{dateTimeEnd:t}=e;return i().tz(t,k()).format(b())},Y=e=>{const{dateTimeStart:t,setDateTimeStart:r}=e,n=(0,D.getSettings)(),s=/a(?!\\)/i.test(n.formats.time.toLowerCase().replace(/\\\\/g,"").split("").reverse().join(""));return(0,j.jsx)(c.DateTimePicker,{currentDate:t,onChange:e=>O(e,r),is12Hour:s})},$=e=>{const{dateTimeEnd:t,setDateTimeEnd:r}=e,n=(0,D.getSettings)(),s=/a(?!\\)/i.test(n.formats.time.toLowerCase().replace(/\\\\/g,"").split("").reverse().join(""));return(0,j.jsx)(c.DateTimePicker,{currentDate:t,onChange:e=>E(e,r),is12Hour:s})},A=e=>{const{dateTimeStart:t,setDateTimeStart:r}=e;return(0,m.useEffect)((()=>{r(i().tz(function(){let e=v("eventDetails.dateTime.datetime_start");return e=""!==e?i().tz(e,k()).format(w):z,T("eventDetails.dateTime.datetime_start",e),e}(),k()).format(w)),p({setDateTimeStart:t}),_()})),(0,j.jsx)(c.PanelRow,{children:(0,j.jsxs)(c.Flex,{direction:"column",gap:"0",children:[(0,j.jsx)(c.FlexItem,{children:(0,j.jsx)("label",{htmlFor:"gatherpress-datetime-start",children:(0,l.__)("Start","gatherpress")})}),(0,j.jsx)(c.FlexItem,{children:(0,j.jsx)(c.Dropdown,{popoverProps:{placement:"bottom-end"},renderToggle:({isOpen:e,onToggle:r})=>(0,j.jsx)(c.Button,{id:"gatherpress-datetime-start",onClick:r,"aria-expanded":e,isLink:!0,children:(0,j.jsx)(F,{dateTimeStart:t})}),renderContent:()=>(0,j.jsx)(Y,{dateTimeStart:t,setDateTimeStart:r})})})]})})},H=e=>{const{dateTimeEnd:t,setDateTimeEnd:r}=e;return(0,m.useEffect)((()=>{r(i().tz(function(){let e=v("eventDetails.dateTime.datetime_end");return e=""!==e?i().tz(e,k()).format(w):S,T("eventDetails.dateTime.datetime_end",e),e}(),k()).format(w)),p({setDateTimeEnd:t}),_()})),(0,j.jsx)(c.PanelRow,{children:(0,j.jsxs)(c.Flex,{direction:"column",gap:"0",children:[(0,j.jsx)(c.FlexItem,{children:(0,j.jsx)("label",{htmlFor:"gatherpress-datetime-end",children:(0,l.__)("End","gatherpress")})}),(0,j.jsx)(c.FlexItem,{children:(0,j.jsx)(c.Dropdown,{popoverProps:{placement:"bottom-end"},renderToggle:({isOpen:e,onToggle:r})=>(0,j.jsx)(c.Button,{id:"gatherpress-datetime-end",onClick:r,"aria-expanded":e,isLink:!0,children:(0,j.jsx)(M,{dateTimeEnd:t})}),renderContent:()=>(0,j.jsx)($,{dateTimeEnd:t,setDateTimeEnd:r})})})]})})},L=e=>{const{timezone:t,setTimezone:r}=e,n=v("misc.timezoneChoices");return(0,m.useEffect)((()=>{r(v("eventDetails.dateTime.timezone"))}),[r]),(0,m.useEffect)((()=>{p({setTimezone:v("eventDetails.dateTime.timezone")})})),(0,j.jsx)(c.PanelRow,{children:(0,j.jsx)(c.SelectControl,{label:(0,l.__)("Time Zone","gatherpress"),value:C(t),onChange:e=>{e=function(e=""){const t=/^UTC([+-])(\d+)(.\d+)?$/,r=e.replace(t,"$1");if(r!==e){const n=e.replace(t,"$2").padStart(2,"0");let s=e.replace(t,"$3");return""===s&&(s=":00"),s=s.replace(".25",":15").replace(".5",":30").replace(".75",":45"),r+n+s}return e}(e),r(e),T("eventDetails.dateTime.timezone",e),g()},children:Object.keys(n).map((e=>(0,j.jsx)("optgroup",{label:e,children:Object.keys(n[e]).map((t=>(0,j.jsx)("option",{value:t,children:n[e][t]},t)))},e)))})})},B=()=>{const[e,t]=(0,m.useState)(),[r,n]=(0,m.useState)(),[s,a]=(0,m.useState)();return function(){const e=(0,u.select)("core/editor").isSavingPost(),t=(0,u.select)("core/editor").isAutosavingPost();"gatherpress_event"===(0,u.select)("core/editor")?.getCurrentPostType()&&e&&!t&&h()({path:v("urls.eventRestApi")+"/datetime",method:"POST",data:{post_id:v("eventDetails.postId"),datetime_start:i().tz(v("eventDetails.dateTime.datetime_start"),k()).format(y),datetime_end:i().tz(v("eventDetails.dateTime.datetime_end"),k()).format(y),timezone:v("eventDetails.dateTime.timezone"),_wpnonce:v("misc.nonce")}}).then((()=>{!function(){const e="gatherpress_event_communcation",t=(0,u.dispatch)("core/notices");t.removeNotice(e),"publish"!==(0,u.select)("core/editor").getEditedPostAttribute("status")||x()||t.createNotice("success",(0,l.__)("Send an event update to members via email?","gatherpress"),{id:e,isDismissible:!0,actions:[{onClick:()=>{p({setOpen:!0})},label:(0,l.__)("Compose Message","gatherpress")}]})}()}))}(),(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("h3",{children:(0,l.__)("Date & time","gatherpress")}),(0,j.jsx)(A,{dateTimeStart:e,setDateTimeStart:t}),(0,j.jsx)(H,{dateTimeEnd:r,setDateTimeEnd:n}),(0,j.jsx)(L,{timezone:s,setTimezone:a})]})},I=(e,t,r)=>{const n=P(v("settings.dateFormat")),s=P(v("settings.timeFormat")),a=v("settings.showTimezone")?"z":"",o=n+" "+s,d=k(r);let c=n+" "+s+" "+a;return i().tz(e,d).format(n)===i().tz(t,d).format(n)&&(c=s+" "+a),(0,l.sprintf)(/* translators: %1$s: datetime start, %2$s: datetime end, %3$s timezone. */ /* translators: %1$s: datetime start, %2$s: datetime end, %3$s timezone. */
(0,l.__)("%1$s to %2$s %3$s","gatherpress"),i().tz(e,d).format(o),i().tz(t,d).format(c),(m=k(m=d),(0,l.__)("GMT","gatherpress")!==m?"":function(e=""){return e.replace(":","")}(v("eventDetails.dateTime.timezone"))));var m},N=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"gatherpress/event-date","version":"2.0.0","title":"Event Date","category":"gatherpress","icon":"clock","example":{"viewportWidth":350},"description":"Displays the date and time for an event.","attributes":{"eventEnd":{"type":"string"},"eventStart":{"type":"string"},"textAlign":{"type":"string"},"format":{"type":"string"},"isLink":{"type":"boolean","default":false},"displayType":{"type":"string","default":"date"}},"supports":{"html":false,"color":{"gradients":true,"link":true,"__experimentalDefaultControls":{"background":true,"text":true,"link":true}},"spacing":{"margin":true,"padding":true},"typography":{"fontSize":true,"lineHeight":true,"__experimentalFontFamily":true,"__experimentalFontWeight":true,"__experimentalFontStyle":true,"__experimentalTextTransform":true,"__experimentalTextDecoration":true,"__experimentalLetterSpacing":true,"__experimentalDefaultControls":{"fontSize":true}},"interactivity":{"clientNavigation":true},"__experimentalBorder":{"radius":true,"color":true,"width":true,"style":true,"__experimentalDefaultControls":{"radius":true,"color":true,"width":true,"style":true}}},"textdomain":"gatherpress","editorScript":"file:./index.js","style":"file:./style-index.css","render":"file:./render.php"}');(0,n.registerBlockType)(N,{edit:({attributes:{textAlign:e,format:t,isLink:r,displayType:n},setAttributes:s})=>{const[i,a]=(0,m.useState)(z),[l,p]=(0,m.useState)(S),[f,h]=(0,m.useState)(k()),g=(0,d.useBlockProps)({className:o({[`has-text-align-${e}`]:e})});return((e,t="")=>{for(const[r,n]of Object.entries(e)){let e=r;t&&(e+="_"+String(t)),addEventListener(e,(e=>{n(e.detail)}),!1)}})({setDateTimeEnd:p,setDateTimeStart:a,setTimezone:h}),(0,j.jsxs)("div",{...g,children:[(0,j.jsx)(d.BlockControls,{children:(0,j.jsx)(d.AlignmentToolbar,{value:e,onChange:e=>s({textAlign:e})})}),I(i,l,f),"string"==typeof(0,u.select)("core/editor")?.getCurrentPostType()&&(0,j.jsx)(d.InspectorControls,{children:(0,j.jsx)(c.PanelBody,{children:(0,j.jsx)(B,{})})})]})},save:()=>null})}},r={};function n(e){var s=r[e];if(void 0!==s)return s.exports;var i=r[e]={exports:{}};return t[e](i,i.exports,n),i.exports}n.m=t,e=[],n.O=(t,r,s,i)=>{if(!r){var a=1/0;for(c=0;c<e.length;c++){for(var[r,s,i]=e[c],o=!0,l=0;l<r.length;l++)(!1&i||a>=i)&&Object.keys(n.O).every((e=>n.O[e](r[l])))?r.splice(l--,1):(o=!1,i<a&&(a=i));if(o){e.splice(c--,1);var d=s();void 0!==d&&(t=d)}}return t}i=i||0;for(var c=e.length;c>0&&e[c-1][2]>i;c--)e[c]=e[c-1];e[c]=[r,s,i]},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={532:0,4:0};n.O.j=t=>0===e[t];var t=(t,r)=>{var s,i,[a,o,l]=r,d=0;if(a.some((t=>0!==e[t]))){for(s in o)n.o(o,s)&&(n.m[s]=o[s]);if(l)var c=l(n)}for(t&&t(r);d<a.length;d++)i=a[d],n.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return n.O(c)},r=globalThis.webpackChunkgatherpress=globalThis.webpackChunkgatherpress||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var s=n.O(void 0,[4],(()=>n(3358)));s=n.O(s)})();